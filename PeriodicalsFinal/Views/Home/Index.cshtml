@using PeriodicalsFinal.DataAccess.Models


@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Editions";

    var editions = ViewBag.Editions;
}

<div class="sorting">
    <span>
        Sort by price:
        @Html.ActionLink("Asceding", "Index", "Home", new { price = "Asc" }, new { @id = "priceSort Asc" })
        @Html.ActionLink("Desceding", "Index", "Home", new { price = "Desc" }, new { @id = "priceSort Desc" })

        Sort by edition:
        @Html.ActionLink("A-Z", "Index", "Home", new { alphabet = "Asc" }, new { @id = "EditionSort Asc" })
        @Html.ActionLink("Z-A", "Index", "Home", new { alphabet = "Desc" }, new { @id = "EditionSort Desc" })

    </span>
</div>

@foreach (KeyValuePair<EditionModel, IEnumerable<ArticleModel>> edition in editions)
{
    // Converts image from byte array to an image
    var base64 = Convert.ToBase64String(edition.Key.EditionImage);
    var imgSrc = String.Format("data:image/png;base64,{0}", base64);


    <div class="edition-wrapper mb-4">
        <p class="h3 text-uppercase font-weight-bold">@edition.Key.Magazine.MagazineName</p>
        <hr />
        <div class="row">
            <div class="col-md-6 edition-cover">
                <img src="@imgSrc" alt="@edition.Key.EditionTitle Cover" class="img-thumbnail img-fluid" />
            </div>
            <div class="col-md-6 edition-info">
                @Html.ActionLink($"{edition.Key.EditionMonth} {edition.Key.EditionYear}", "Index", "Edition", new { magazine = edition.Key.Magazine.MagazineName, year = edition.Key.EditionYear, month = (int)edition.Key.EditionMonth }, new { @class = "edition-date" })

                <p class="edition-title">@edition.Key.EditionTitle</p>


                @foreach (ArticleModel article in edition.Value)
                {
                    <span class="article-preview-title">@article.ArticleTitle</span>

                    if (article.ShortDescription != null)
                    {
                        <p class="article-preview-shortTitle">@article.ShortDescription</p>
                    }
                }

            </div>
        </div>
    </div>
}


